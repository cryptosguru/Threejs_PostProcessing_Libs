/**
 * postprocessing v0.1.0 build Feb 02 2016
 * https://github.com/vanruesc/postprocessing
 * Copyright 2016 Raoul van RÃ¼schen, Zlib
 */
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],b):b(a.POSTPROCESSING={},a.THREE)}(this,function(a,b){"use strict";function c(){b.ShaderMaterial.call(this,{defines:{MIP_LEVEL_1X1:0},uniforms:{lastLum:{type:"t",value:null},currentLum:{type:"t",value:null},delta:{type:"f",value:.016},tau:{type:"f",value:1}},fragmentShader:E.fragment,vertexShader:E.vertex})}function d(a){b.ShaderMaterial.call(this,{uniforms:{tDiffuse:{type:"t",value:null},strength:{type:"f",value:0}},fragmentShader:F.fragment,vertexShader:F.vertex}),a===G.HORIZONTAL&&(this.defines.HORIZONTAL="1")}function e(){b.ShaderMaterial.call(this,{defines:{RINGS:"3",SAMPLES:"4"},uniforms:{textureWidth:{type:"f",value:1},textureHeight:{type:"f",value:1},focalDepth:{type:"f",value:1},focalLength:{type:"f",value:24},fstop:{type:"f",value:.9},tColor:{type:"t",value:null},tDepth:{type:"t",value:null},maxblur:{type:"f",value:1},showFocus:{type:"i",value:0},manualdof:{type:"i",value:0},vignetting:{type:"i",value:0},depthblur:{type:"i",value:0},threshold:{type:"f",value:.5},gain:{type:"f",value:2},bias:{type:"f",value:.5},fringe:{type:"f",value:.7},znear:{type:"f",value:.1},zfar:{type:"f",value:2e3},noise:{type:"i",value:1},dithering:{type:"f",value:1e-4},pentagon:{type:"i",value:0},shaderFocus:{type:"i",value:1},focusCoords:{type:"v2",value:new b.Vector2}},fragmentShader:H.fragment,vertexShader:H.vertex})}function f(a,c){b.ShaderMaterial.call(this,{uniforms:{texture1:{type:"t",value:null},texture2:{type:"t",value:null},opacity1:{type:"f",value:1},opacity2:{type:"f",value:1}},fragmentShader:I.fragment,vertexShader:I.vertex}),a&&(this.defines.INVERT_TEX1="1"),c&&(this.defines.INVERT_TEX2="1")}function g(a,b){return Math.exp(-(a*a)/(2*b*b))}function h(){b.ShaderMaterial.call(this,{defines:{KERNEL_SIZE_FLOAT:"0.0",KERNEL_SIZE_INT:"0"},uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new b.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},fragmentShader:J.fragment,vertexShader:J.vertex})}function i(){b.ShaderMaterial.call(this,{uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},fragmentShader:K.fragment,vertexShader:K.vertex})}function j(){b.ShaderMaterial.call(this,{uniforms:{tDiffuse:{type:"t",value:null},angle:{type:"f",value:1.57},scale:{type:"f",value:1},offsetRepeat:{type:"v4",value:new b.Vector4(.5,.5,1,1)}},fragmentShader:L.fragment,vertexShader:L.vertex})}function k(){b.ShaderMaterial.call(this,{uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},fragmentShader:M.fragment,vertexShader:M.vertex})}function l(){b.ShaderMaterial.call(this,{uniforms:{tDiffuse:{type:"t",value:null},tPerturb:{type:"t",value:null},active:{type:"i",value:1},amount:{type:"f",value:.8},angle:{type:"f",value:.02},seed:{type:"f",value:.02},seedX:{type:"f",value:.02},seedY:{type:"f",value:.02},distortionX:{type:"f",value:.5},distortionY:{type:"f",value:.6},colS:{type:"f",value:.05}},fragmentShader:N.fragment,vertexShader:N.vertex})}function m(){b.ShaderMaterial.call(this,{defines:{NUM_SAMPLES_FLOAT:"20.0",NUM_SAMPLES_INT:"20"},uniforms:{tDiffuse:{type:"t",value:null},lightPosition:{type:"v3",value:null},exposure:{type:"f",value:.6},decay:{type:"f",value:.93},density:{type:"f",value:.96},weight:{type:"f",value:.4},clampMax:{type:"f",value:1}},fragmentShader:O.fragment,vertexShader:O.vertex})}function n(){b.ShaderMaterial.call(this,{uniforms:{tDiffuse:{type:"t",value:null}},fragmentShader:P.fragment,vertexShader:P.vertex})}function o(){b.ShaderMaterial.call(this,{uniforms:{tDiffuse:{type:"t",value:null},luminanceMap:{type:"t",value:null},averageLuminance:{type:"f",value:1},maxLuminance:{type:"f",value:16},middleGrey:{type:"f",value:.6}},fragmentShader:Q.fragment,vertexShader:Q.vertex})}function p(a,c,d){this.scene=void 0!==a?a:new b.Scene,this.camera=void 0!==c?c:new b.OrthographicCamera(-1,1,1,-1,0,1),this.quad=void 0!==d?d:new b.Mesh(new b.PlaneBufferGeometry(2,2),null),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!1,null!==this.scene&&(null!==this.camera&&null===this.camera.parent&&this.scene.add(this.camera),null!==this.quad&&this.scene.add(this.quad))}function q(a,d){p.call(this),this.resolution=void 0!==d?d:256,this.adaptive=void 0!==a?!1:!0,this.needsInit=!0,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,this.materialCopy=new i,this.materialCopy.blending=b.NoBlending,this.materialCopy.depthTest=!1,this.materialLuminance=new n,this.materialLuminance.blending=b.NoBlending,this.materialAdaptiveLuminosity=new c,this.materialAdaptiveLuminosity.defines.MIP_LEVEL_1X1=(Math.log(this.resolution)/Math.log(2)).toFixed(1),this.materialAdaptiveLuminosity.blending=b.NoBlending,this.materialToneMapping=new o,this.materialToneMapping.blending=b.NoBlending,this.needsSwap=!0}function r(a){p.call(this),void 0===a&&(a={}),this.renderTargetX=new b.WebGLRenderTarget(1,1,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBFormat}),this.renderTargetX.texture.generateMipmaps=!1,this.renderTargetY=this.renderTargetX.clone(),this.renderTargetY.stencilBuffer=!1,this.renderTargetY.depthBuffer=!1,this.resolution=void 0===a.resolution?256:a.resolution,this.blurX=new b.Vector2(R,0),this.blurY=new b.Vector2(0,R),this.combineMaterial=new f,void 0!==a.strength&&(this.combineMaterial.uniforms.opacity2.value=a.strength),this.copyMaterial=new i,this.copyMaterial.blending=b.AdditiveBlending,this.copyMaterial.transparent=!0,void 0!==a.strength&&(this.copyMaterial.uniforms.opacity.value=a.strength),this.convolutionMaterial=new h,this.convolutionMaterial.buildKernel(void 0!==a.sigma?a.sigma:4),this.clear=!1}function s(a,c,d){p.call(this),void 0===d&&(d={}),void 0===d.resolution&&(d.resolution=256),this.renderTargetDepth=new b.WebGLRenderTarget(1,1,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBFormat,stencilBuffer:!1}),this.renderTargetDepth.texture.generateMipmaps=!1,this.depthMaterial=new b.MeshDepthMaterial,this.bokehMaterial=new e,this.bokehMaterial.uniforms.tDepth.value=this.renderTargetDepth,void 0!==d.focus&&(this.bokehMaterial.uniforms.focus.value=d.focus),void 0!==d.aspect&&(this.bokehMaterial.uniforms.aspect.value=d.aspect),void 0!==d.aperture&&(this.bokehMaterial.uniforms.aperture.value=d.aperture),void 0!==d.maxBlur&&(this.bokehMaterial.uniforms.maxBlur.value=d.maxBlur),this.renderToScreen=!1,this.mainScene=void 0!==a?a:new b.Scene,this.mainCamera=void 0!==c?c:new b.PerspectiveCamera,this.quad.material=this.bokehMaterial}function t(){p.call(this,null,null,null)}function u(a){p.call(this),void 0===a&&(a={}),this.material=new j,void 0!==a.angle&&(this.material.uniforms.angle.value=a.angle),void 0!==a.scale&&(this.material.uniforms.scale.value=a.scale),this.needsSwap=!0}function v(a){p.call(this),void 0===a&&(a={}),this.material=new k,void 0!==a&&(void 0!==a.grayscale&&(this.material.uniforms.grayscale.value=a.grayscale),void 0!==a.noiseIntensity&&(this.material.uniforms.nIntensity.value=a.noiseIntensity),void 0!==a.scanlinesIntensity&&(this.material.uniforms.sIntensity.value=a.scanlinesIntensity),void 0!==a.scanlinesCount&&(this.material.uniforms.sCount.value=a.scanlinesCount)),this.quad.material=this.material,this.needsSwap=!0}function w(a){p.call(this),void 0===a&&(a={}),void 0===a.dtSize&&(a.dtSize=64),this.material=new l,void 0!==a.perturbMap?(this.perturbMap=a.perturbMap,this.perturbMap.generateMipmaps=!1,this.material.uniforms.tPerturb.value=this.perturbMap):(this.perturbMap=null,this.generatePerturbMap(a.dtSize)),this.mode=S.SPORADIC,this.counter=0,this.quad.material=this.material,this.needsSwap=!0,this.generateTrigger()}function x(a,c,e,g){p.call(this),void 0===g&&(g={}),this.renderTargetX=new b.WebGLRenderTarget(1,1,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBFormat,stencilBuffer:!1}),this.renderTargetX.texture.generateMipmaps=!1,this.renderTargetY=this.renderTargetX.clone(),this.renderTargetY.depthBuffer=!1,this.resolutionScale=void 0===g.resolutionScale?.5:g.resolutionScale,this.lightSource=void 0!==e?e:new b.Object3D,this.screenPosition=new b.Vector3,this.horizontalBlurMaterial=new d(G.HORIZONTAL),this.verticalBlurMaterial=new d(G.VERTICAL),this.combineMaterial=new f,this.copyMaterial=new i,this.copyMaterial.blending=b.AdditiveBlending,this.copyMaterial.transparent=!0,this.maskMaterial=new b.MeshBasicMaterial({color:0}),this.godRaysMaterial=new m,this.godRaysMaterial.uniforms.lightPosition.value=this.screenPosition,void 0!==g.exposure&&(this.godRaysMaterial.uniforms.exposure.value=g.exposure),void 0!==g.density&&(this.godRaysMaterial.uniforms.density.value=g.density),void 0!==g.decay&&(this.godRaysMaterial.uniforms.decay.value=g.decay),void 0!==g.weight&&(this.godRaysMaterial.uniforms.weight.value=g.weight),void 0!==g.clampMax&&(this.godRaysMaterial.uniforms.clampMax.value=g.clampMax),this.samples=g.samples,this.intensity=g.intensity,this.blurriness=void 0===g.blurriness?3:g.blurriness,this.mainScene=void 0!==a?a:new b.Scene,this.mainCamera=void 0!==c?c:new b.PerspectiveCamera,this.needsSwap=!0}function y(a,b){p.call(this,a,b,null),this.inverse=!1,this.clear=!0}function z(a,c,d,e,f){p.call(this,a,c,null),this.overrideMaterial=void 0!==d?d:null,this.clearColor=void 0!==e?e:null,this.clearAlpha=void 0===f?1:b.Math.clamp(f,0,1),this.clear=!0}function A(a){p.call(this),this.material=new i,void 0===a&&(a=new b.WebGLRenderTarget(1,1,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBFormat,stencilBuffer:!1})),this.renderTarget=a,this.renderTarget.texture.generateMipmaps=!1,this.quad.material=this.material}function B(a,b){p.call(this),this.textureID=void 0!==b?b:"tDiffuse",this.material=void 0!==a?a:null,this.needsSwap=!0,this.quad.material=this.material}function C(a,c){p.call(this),this.combineMaterial=new f,this.combineMaterial.uniforms.texture2.value=a,void 0!==c&&(this.combineMaterial.uniforms.opacity2.value=c),this.copyMaterial=new i,this.copyMaterial.blending=b.AdditiveBlending,this.copyMaterial.transparent=!0,this.copyMaterial.uniforms.tDiffuse.value=a,this.copyMaterial.uniforms.opacity.value=void 0===c?1:c}function D(a,c){var d,e,f;this.renderer=void 0!==a?a:new b.WebGLRenderer,this.renderer.autoClear=!1,void 0===c&&(d=this.renderer.getPixelRatio(),e=Math.floor(this.renderer.context.canvas.width/d)||1,f=Math.floor(this.renderer.context.canvas.height/d)||1,c=new b.WebGLRenderTarget(e,f,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBFormat,stencilBuffer:!1})),this.renderTarget1=c,this.renderTarget2=c.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],this.copyPass=new B(new i)}b="default"in b?b["default"]:b;var E={fragment:"uniform sampler2D lastLum;\nuniform sampler2D currentLum;\nuniform float delta;\nuniform float tau;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec4 lastLum = texture2D(lastLum, vUv, MIP_LEVEL_1X1);\n	vec4 currentLum = texture2D(currentLum, vUv, MIP_LEVEL_1X1);\n\n	float fLastLum = lastLum.r;\n	float fCurrentLum = currentLum.r;\n\n	// Better results with squared input luminance.\n	fCurrentLum *= fCurrentLum;\n\n	// Adapt the luminance using Pattanaik's technique.\n	float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));\n	// fAdaptedLum = sqrt(fAdaptedLum);\n\n	gl_FragColor = vec4(fAdaptedLum, fAdaptedLum, fAdaptedLum, 1.0);\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};c.prototype=Object.create(b.ShaderMaterial.prototype),c.prototype.constructor=c;var F={fragment:"uniform sampler2D tDiffuse;\nuniform float strength;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec4 offset = vec4(\n		1.0 * strength,\n		2.0 * strength,\n		3.0 * strength,\n		4.0 * strength\n	);\n\n	#ifdef HORIZONTAL\n\n		vec2 coord1 = vec2(vUv.x - offset.x, vUv.y);\n		vec2 coord2 = vec2(vUv.x - offset.y, vUv.y);\n		vec2 coord3 = vec2(vUv.x - offset.z, vUv.y);\n		vec2 coord4 = vec2(vUv.x - offset.w, vUv.y);\n\n	#else\n\n		vec2 coord1 = vec2(vUv.x, vUv.y - offset.x);\n		vec2 coord2 = vec2(vUv.x, vUv.y - offset.y);\n		vec2 coord3 = vec2(vUv.x, vUv.y - offset.z);\n		vec2 coord4 = vec2(vUv.x, vUv.y - offset.w);\n\n	#endif\n\n	vec4 sum = vec4(0.0);\n\n	sum += texture2D(tDiffuse, coord4) * 0.051;\n	sum += texture2D(tDiffuse, coord3) * 0.0918;\n	sum += texture2D(tDiffuse, coord2) * 0.12245;\n	sum += texture2D(tDiffuse, coord1) * 0.1531;\n\n	sum += texture2D(tDiffuse, vec2(vUv.x, vUv.y)) * 0.1633;\n\n	sum += texture2D(tDiffuse, coord1) * 0.1531;\n	sum += texture2D(tDiffuse, coord2) * 0.12245;\n	sum += texture2D(tDiffuse, coord3) * 0.0918;\n	sum += texture2D(tDiffuse, coord4) * 0.051;\n\n	gl_FragColor = sum;\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = vec2(uv.x, 1.0 - uv.y);\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"},G=Object.freeze({HORIZONTAL:0,VERTICAL:1});d.prototype=Object.create(b.ShaderMaterial.prototype),d.prototype.constructor=d;var H={fragment:"uniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float textureWidth;\nuniform float textureHeight;\n\nuniform float focalDepth;\nuniform float focalLength;\nuniform float fstop;\nuniform bool showFocus;\n\nuniform float znear;\nuniform float zfar;\n\nuniform bool manualdof;\nuniform bool vignetting;\nuniform bool shaderFocus;\nuniform bool noise;\nuniform bool depthblur;\nuniform bool pentagon;\n\nuniform vec2 focusCoords;\nuniform float maxblur;\nuniform float threshold;\nuniform float gain;\nuniform float bias;\nuniform float fringe;\nuniform float dithering;\n\nvarying vec2 vUv;\n\nconst float PI = 3.14159265;\nconst float TWO_PI = PI * 2.0;\nconst int samples = SAMPLES; // Samples on the first ring.\nconst int rings = RINGS;\nconst int maxringsamples = rings * samples;\n\nfloat ndofstart = 1.0; \nfloat ndofdist = 2.0;\nfloat fdofstart = 1.0;\nfloat fdofdist = 3.0;\n\nfloat CoC = 0.03; // Circle of Confusion size in mm (35mm film = 0.03mm).\n\nfloat vignout = 1.3;\nfloat vignin = 0.0;\nfloat vignfade = 22.0; \n\nfloat dbsize = 1.25;\nfloat feather = 0.4;\n\n/**\n * Pentagonal shape creation.\n */\n\nfloat penta(vec2 coords) {\n\n	float scale = float(rings) - 1.3;\n\n	vec4  HS0 = vec4( 1.0,          0.0,         0.0,  1.0);\n	vec4  HS1 = vec4( 0.309016994,  0.951056516, 0.0,  1.0);\n	vec4  HS2 = vec4(-0.809016994,  0.587785252, 0.0,  1.0);\n	vec4  HS3 = vec4(-0.809016994, -0.587785252, 0.0,  1.0);\n	vec4  HS4 = vec4( 0.309016994, -0.951056516, 0.0,  1.0);\n	vec4  HS5 = vec4( 0.0        ,  0.0        , 1.0,  1.0);\n\n	vec4  one = vec4(1.0);\n\n	vec4 P = vec4((coords), vec2(scale, scale));\n\n	vec4 dist = vec4(0.0);\n	float inorout = -4.0;\n\n	dist.x = dot(P, HS0);\n	dist.y = dot(P, HS1);\n	dist.z = dot(P, HS2);\n	dist.w = dot(P, HS3);\n\n	dist = smoothstep(-feather, feather, dist);\n\n	inorout += dot(dist, one);\n\n	dist.x = dot(P, HS4);\n	dist.y = HS5.w - abs(P.z);\n\n	dist = smoothstep(-feather, feather, dist);\n	inorout += dist.x;\n\n	return clamp(inorout, 0.0, 1.0);\n\n}\n\n/**\n * Depth buffer blur.\n */\n\nfloat bdepth(vec2 coords) {\n\n	float d = 0.0;\n	float kernel[9];\n	vec2 offset[9];\n\n	vec2 wh = vec2(1.0 / textureWidth,1.0 / textureHeight) * dbsize;\n\n	offset[0] = vec2(-wh.x, -wh.y);\n	offset[1] = vec2(0.0, -wh.y);\n	offset[2] = vec2(wh.x -wh.y);\n\n	offset[3] = vec2(-wh.x,  0.0);\n	offset[4] = vec2(0.0,   0.0);\n	offset[5] = vec2(wh.x,  0.0);\n\n	offset[6] = vec2(-wh.x, wh.y);\n	offset[7] = vec2(0.0, wh.y);\n	offset[8] = vec2(wh.x, wh.y);\n\n	kernel[0] = 1.0 / 16.0; kernel[1] = 2.0 / 16.0; kernel[2] = 1.0 / 16.0;\n	kernel[3] = 2.0 / 16.0; kernel[4] = 4.0 / 16.0; kernel[5] = 2.0 / 16.0;\n	kernel[6] = 1.0 / 16.0; kernel[7] = 2.0 / 16.0; kernel[8] = 1.0 / 16.0;\n\n	for(int i = 0; i < 9; ++i) {\n\n		float tmp = texture2D(tDepth, coords + offset[i]).r;\n		d += tmp * kernel[i];\n\n	}\n\n	return d;\n\n}\n\n/**\n * Processing the sample.\n */\n\nvec3 color(vec2 coords, float blur) {\n\n	vec3 col = vec3(0.0);\n	vec2 texel = vec2(1.0 / textureWidth, 1.0 / textureHeight);\n\n	col.r = texture2D(tColor, coords + vec2(0.0, 1.0) * texel * fringe * blur).r;\n	col.g = texture2D(tColor, coords + vec2(-0.866, -0.5) * texel * fringe * blur).g;\n	col.b = texture2D(tColor, coords + vec2(0.866, -0.5) * texel * fringe * blur).b;\n\n	vec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n	float lum = dot(col.rgb, lumcoeff);\n	float thresh = max((lum - threshold) * gain, 0.0);\n\n	return col + mix(vec3(0.0), col, thresh * blur);\n\n}\n\n/**\n * Generating noise/pattern texture for dithering.\n */\n\nvec2 rand(vec2 coord) {\n\n	float noiseX = ((fract(1.0 - coord.s * (textureWidth / 2.0)) * 0.25) + (fract(coord.t * (textureHeight / 2.0)) * 0.75)) * 2.0 - 1.0;\n	float noiseY = ((fract(1.0 - coord.s * (textureWidth / 2.0)) * 0.75) + (fract(coord.t * (textureHeight / 2.0)) * 0.25)) * 2.0 - 1.0;\n\n	if(noise) {\n\n		noiseX = clamp(fract(sin(dot(coord, vec2(12.9898, 78.233))) * 43758.5453), 0.0, 1.0) * 2.0 - 1.0;\n		noiseY = clamp(fract(sin(dot(coord, vec2(12.9898, 78.233) * 2.0)) * 43758.5453), 0.0, 1.0) * 2.0 - 1.0;\n\n	}\n\n	return vec2(noiseX, noiseY);\n\n}\n\n/**\n * Distance based edge smoothing.\n */\n\nvec3 debugFocus(vec3 col, float blur, float depth) {\n\n	float edge = 0.002 * depth;\n	float m = clamp(smoothstep(0.0, edge, blur), 0.0, 1.0);\n	float e = clamp(smoothstep(1.0 - edge, 1.0, blur), 0.0, 1.0);\n\n	col = mix(col, vec3(1.0, 0.5, 0.0), (1.0 - m) * 0.6);\n	col = mix(col, vec3(0.0, 0.5, 1.0), ((1.0 - e) - (1.0 - m)) * 0.2);\n\n	return col;\n\n}\n\nfloat linearize(float depth) {\n\n	return -zfar * znear / (depth * (zfar - znear) - zfar);\n\n}\n\nfloat vignette() {\n\n	float dist = distance(vUv.xy, vec2(0.5, 0.5));\n	dist = smoothstep(vignout + (fstop / vignfade), vignin + (fstop / vignfade), dist);\n\n	return clamp(dist, 0.0, 1.0);\n\n}\n\nfloat gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n\n	float rings2 = float(rings);\n	float step = TWO_PI / float(ringsamples);\n	float pw = cos(j * step) * i;\n	float ph = sin(j * step) * i;\n	float p = 1.0;\n\n	if(pentagon) {\n\n		p = penta(vec2(pw,ph));\n\n	}\n\n	col += color(vUv.xy + vec2(pw * w, ph * h), blur) * mix(1.0, i / rings2, bias) * p;\n\n	return 1.0 * mix(1.0, i / rings2, bias) * p;\n\n}\n\nvoid main() {\n\n	// Scene depth calculation.\n\n	float depth = linearize(texture2D(tDepth, vUv.xy).x);\n\n	if(depthblur) { depth = linearize(bdepth(vUv.xy)); }\n\n	// Focal plane calculation.\n\n	float fDepth = focalDepth;\n\n	if(shaderFocus) { fDepth = linearize(texture2D(tDepth, focusCoords).x); }\n\n	// Dof blur factor calculation.\n\n	float blur = 0.0;\n\n	float a, b, c, d, o;\n\n	if(manualdof) {\n\n		a = depth - fDepth; // Focal plane.\n		b = (a - fdofstart) / fdofdist; // Far DoF.\n		c = (-a - ndofstart) / ndofdist; // Near Dof.\n		blur = (a > 0.0) ? b : c;\n\n	} else {\n\n		f = focalLength; // Focal length in mm.\n		d = fDepth * 1000.0; // Focal plane in mm.\n		o = depth * 1000.0; // Depth in mm.\n\n		a = (o * f) / (o - f);\n		b = (d * f) / (d - f);\n		c = (d - f) / (d * fstop * CoC);\n\n		blur = abs(a - b) * c;\n	}\n\n	blur = clamp(blur, 0.0, 1.0);\n\n	// Calculation of pattern for dithering.\n\n	vec2 noise = rand(vUv.xy) * dithering * blur;\n\n	// Getting blur x and y step factor.\n\n	float w = (1.0 / textureWidth) * blur * maxblur + noise.x;\n	float h = (1.0 / textureHeight) * blur * maxblur + noise.y;\n\n	// Calculation of final color.\n\n	vec3 col = vec3(0.0);\n\n	if(blur < 0.05) {\n\n		// Some optimization thingy.\n		col = texture2D(tColor, vUv.xy).rgb;\n\n	} else {\n\n		col = texture2D(tColor, vUv.xy).rgb;\n		float s = 1.0;\n		int ringsamples;\n\n		for(int i = 1; i <= rings; ++i) {\n\n			// Unboxing.\n			ringsamples = i * samples;\n\n			for(int j = 0; j < maxringsamples; ++j) {\n\n				if(j >= ringsamples) { break; }\n\n				s += gather(float(i), float(j), ringsamples, col, w, h, blur);\n\n			}\n\n		}\n\n		col /= s; // Divide by sample count.\n\n	}\n\n	if(showFocus) { col = debugFocus(col, blur, depth); }\n\n	if(vignetting) { col *= vignette(); }\n\n	gl_FragColor.rgb = col;\n	gl_FragColor.a = 1.0;\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};e.prototype=Object.create(b.ShaderMaterial.prototype),e.prototype.constructor=e;var I={fragment:"uniform sampler2D texture1;\nuniform sampler2D texture2;\n\nuniform float opacity1;\nuniform float opacity2;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec4 texel1 = texture2D(texture1, vUv);\n	vec4 texel2 = texture2D(texture2, vUv);\n\n	#ifdef INVERT_TEX1\n\n		texel1.rgb = vec3(1.0) - texel1.rgb;\n\n	#endif\n\n	#ifdef INVERT_TEX2\n\n		texel2.rgb = vec3(1.0) - texel2.rgb;\n\n	#endif\n\n	gl_FragColor = opacity1 * texel1 + opacity2 * texel2;\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};f.prototype=Object.create(b.ShaderMaterial.prototype),f.prototype.constructor=f;var J={fragment:"uniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE_INT];\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec2 coord = vUv;\n	vec4 sum = vec4(0.0);\n\n	for(int i = 0; i < KERNEL_SIZE_INT; ++i) {\n\n		sum += texture2D(tDiffuse, coord) * cKernel[i];\n		coord += uImageIncrement;\n\n	}\n\n	gl_FragColor = sum;\n\n}\n",vertex:"uniform vec2 uImageIncrement;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv - ((KERNEL_SIZE_FLOAT - 1.0) / 2.0) * uImageIncrement;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};h.prototype=Object.create(b.ShaderMaterial.prototype),h.prototype.constructor=h,h.prototype.buildKernel=function(a){var b,c,d,e,f=25,h=2*Math.ceil(3*a)+1;for(h>f&&(h=f),e=.5*(h-1),c=this.uniforms.cKernel.value,c.length=0,d=0,b=0;h>b;++b)c[b]=g(b-e,a),d+=c[b];for(b=0;h>b;++b)c[b]/=d;this.defines.KERNEL_SIZE_FLOAT=h.toFixed(1),this.defines.KERNEL_SIZE_INT=h.toFixed(0)};var K={fragment:"uniform sampler2D tDiffuse;\nuniform float opacity;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec4 texel = texture2D(tDiffuse, vUv);\n	gl_FragColor = opacity * texel;\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};i.prototype=Object.create(b.ShaderMaterial.prototype),i.prototype.constructor=i;var L={fragment:"uniform sampler2D tDiffuse;\n\nuniform float angle;\nuniform float scale;\n\nvarying vec2 vUv;\nvarying vec2 vUvPattern;\n\nfloat pattern() {\n\n	float s = sin(angle);\n	float c = cos(angle);\n\n	vec2 point = vec2(c * vUvPattern.x - s * vUvPattern.y, s * vUvPattern.x + c * vUvPattern.y) * scale;\n\n	return (sin(point.x) * sin(point.y)) * 4.0;\n\n}\n\nvoid main() {\n\n	vec4 color = texture2D(tDiffuse, vUv);\n	float average = (color.r + color.g + color.b) / 3.0;\n\n	gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n\n}\n",vertex:"uniform vec4 offsetRepeat;\n\nvarying vec2 vUv;\nvarying vec2 vUvPattern;\n\nvoid main() {\n\n	vUv = uv;\n	vUvPattern = uv * offsetRepeat.zw + offsetRepeat.xy;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};j.prototype=Object.create(b.ShaderMaterial.prototype),j.prototype.constructor=j;var M={fragment:"uniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec4 cTextureScreen = texture2D(tDiffuse, vUv);\n\n	// Noise.\n\n	float x = vUv.x * vUv.y * time * 1000.0;\n	x = mod(x, 13.0) * mod(x, 123.0);\n	float dx = mod(x, 0.01);\n\n	vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp(0.1 + dx * 100.0, 0.0, 1.0);\n\n	vec2 sc = vec2(sin(vUv.y * sCount), cos(vUv.y * sCount));\n\n	// Scanlines.\n\n	cResult += cTextureScreen.rgb * vec3(sc.x, sc.y, sc.x) * sIntensity;\n\n	cResult = cTextureScreen.rgb + clamp(nIntensity, 0.0, 1.0) * (cResult - cTextureScreen.rgb);\n\n	if(grayscale) {\n\n		cResult = vec3(cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11);\n\n	}\n\n	gl_FragColor =  vec4(cResult, cTextureScreen.a);\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};k.prototype=Object.create(b.ShaderMaterial.prototype),k.prototype.constructor=k;var N={fragment:"uniform sampler2D tDiffuse;\nuniform sampler2D tPerturb;\n\nuniform bool active;\n\nuniform float amount;\nuniform float angle;\nuniform float seed;\nuniform float seedX;\nuniform float seedY;\nuniform float distortionX;\nuniform float distortionY;\nuniform float colS;\n\nvarying vec2 vUv;\n\nfloat rand(vec2 co) {\n\n	return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n\n}\n\nvoid main() {\n\n	vec2 coord = vUv;\n\n	float xs, ys;\n	vec4 normal;\n\n	vec2 offset;\n	vec4 cr, cga, cb;\n	vec4 snow, color;\n\n	float sx, sy;\n\n	if(active) {\n\n		xs = floor(gl_FragCoord.x / 0.5);\n		ys = floor(gl_FragCoord.y / 0.5);\n\n		normal = texture2D(tPerturb, coord * seed * seed);\n\n		if(coord.y < distortionX + colS && coord.y > distortionX - colS * seed) {\n\n			sx = clamp(ceil(seedX), 0.0, 1.0);\n			coord.y = sx * (1.0 - (coord.y + distortionY)) + (1.0 - sx) * distortionY;\n\n		}\n\n		if(coord.x < distortionY + colS && coord.x > distortionY - colS * seed) {\n\n			sy = clamp(ceil(seedY), 0.0, 1.0);\n			coord.x = sy * distortionX + (1.0 - sy) * (1.0 - (coord.x + distortionX));\n\n		}\n\n		coord.x += normal.x * seedX * (seed / 5.0);\n		coord.y += normal.y * seedY * (seed / 5.0);\n\n		offset = amount * vec2(cos(angle), sin(angle));\n\n		cr = texture2D(tDiffuse, coord + offset);\n		cga = texture2D(tDiffuse, coord);\n		cb = texture2D(tDiffuse, coord - offset);\n\n		color = vec4(cr.r, cga.g, cb.b, cga.a);\n		snow = 200.0 * amount * vec4(rand(vec2(xs * seed, ys * seed * 50.0)) * 0.2);\n		color += snow;\n\n	} else {\n\n		color = texture2D(tDiffuse, vUv);\n\n	}\n\n	gl_FragColor = color;\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};l.prototype=Object.create(b.ShaderMaterial.prototype),l.prototype.constructor=l;var O={fragment:"uniform sampler2D tDiffuse;\nuniform vec3 lightPosition;\n\nuniform float exposure;\nuniform float decay;\nuniform float density;\nuniform float weight;\nuniform float clampMax;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec2 texCoord = vUv;\n\n	// Calculate vector from pixel to light source in screen space.\n	vec2 deltaTexCoord = texCoord - lightPosition.st;\n	deltaTexCoord *= 1.0 / NUM_SAMPLES_FLOAT * density;\n\n	// A decreasing illumination factor.\n	float illuminationDecay = 1.0;\n\n	vec4 sample;\n	vec4 color = vec4(0.0);\n\n	// Estimate the probability of occlusion at each pixel by summing samples along a ray to the light source.\n	for(int i = 0; i < NUM_SAMPLES_INT; ++i) {\n\n		texCoord -= deltaTexCoord;\n		sample = texture2D(tDiffuse, texCoord);\n\n		// Apply sample attenuation scale/decay factors.\n		sample *= illuminationDecay * weight;\n\n		color += sample;\n\n		// Update exponential decay factor.\n		illuminationDecay *= decay;\n\n	}\n\n	gl_FragColor = clamp(color * exposure, 0.0, clampMax);\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};m.prototype=Object.create(b.ShaderMaterial.prototype),m.prototype.constructor=m;var P={fragment:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\n\nvoid main() {\n\n	vec4 texel = texture2D(tDiffuse, vUv);\n	vec3 luma = vec3(0.299, 0.587, 0.114);\n	float v = dot(texel.rgb, luma);\n\n	gl_FragColor = vec4(v, v, v, texel.a);\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};n.prototype=Object.create(b.ShaderMaterial.prototype),n.prototype.constructor=n;var Q={fragment:"uniform sampler2D tDiffuse;\nuniform float middleGrey;\nuniform float maxLuminance;\n\n#ifdef ADAPTED_LUMINANCE\n\n	uniform sampler2D luminanceMap;\n\n#else\n\n	uniform float averageLuminance;\n\n#endif\n\nvarying vec2 vUv;\n\nconst vec3 LUM_CONVERT = vec3(0.299, 0.587, 0.114);\n\nvec3 toneMap(vec3 vColor) {\n\n	#ifdef ADAPTED_LUMINANCE\n\n		// Get the calculated average luminance.\n		float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;\n\n	#else\n\n		float fLumAvg = averageLuminance;\n\n	#endif\n\n	// Calculate the luminance of the current pixel.\n	float fLumPixel = dot(vColor, LUM_CONVERT);\n\n	// Apply the modified operator (Eq. 4).\n	float fLumScaled = (fLumPixel * middleGrey) / fLumAvg;\n\n	float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);\n	return fLumCompressed * vColor;\n\n}\n\nvoid main() {\n\n	vec4 texel = texture2D(tDiffuse, vUv);\n	gl_FragColor = vec4(toneMap(texel.rgb), texel.a);\n\n}\n",vertex:"varying vec2 vUv;\n\nvoid main() {\n\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n}\n"};o.prototype=Object.create(b.ShaderMaterial.prototype),o.prototype.constructor=o,p.prototype.render=function(a,b,c,d){throw new Error("Render method not implemented!")},p.prototype.setSize=function(a,b){},p.prototype.dispose=function(){var a,b,c=Object.keys(this);for(a=c.length-1;a>=0;--a)b=this[c[a]],null!==b&&"function"==typeof b.dispose&&(b.dispose(),this[c[a]]=null)},q.prototype=Object.create(p.prototype),q.prototype.constructor=q,q.prototype.render=function(a,b,c,d){this.needsInit&&(this.reset(a),this.luminanceRT.texture.type=c.texture.type,this.previousLuminanceRT.texture.type=c.texture.type,this.currentLuminanceRT.texture.type=c.texture.type,this.needsInit=!1),this.adaptive&&(this.quad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=c,a.render(this.scene,this.camera,this.currentLuminanceRT),this.quad.material=this.materialAdaptiveLuminosity,this.materialAdaptiveLuminosity.uniforms.delta.value=d,this.materialAdaptiveLuminosity.uniforms.lastLum.value=this.previousLuminanceRT,this.materialAdaptiveLuminosity.uniforms.currentLum.value=this.currentLuminanceRT,a.render(this.scene,this.camera,this.luminanceRT),this.quad.material=this.materialCopy,this.materialCopy.uniforms.tDiffuse.value=this.luminanceRT,a.render(this.scene,this.camera,this.previousLuminanceRT)),this.quad.material=this.materialToneMapping,this.materialToneMapping.uniforms.tDiffuse.value=c,a.render(this.scene,this.camera,b,this.clear)},q.prototype.reset=function(a){null!==this.luminanceRT&&this.luminanceRT.dispose(),null!==this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),null!==this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var c={minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBFormat};this.luminanceRT=new b.WebGLRenderTarget(this.resolution,this.resolution,c),this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new b.WebGLRenderTarget(this.resolution,this.resolution,c),this.previousLuminanceRT.texture.generateMipmaps=!1,c.minFilter=b.LinearMipMapLinearFilter,this.currentLuminanceRT=new b.WebGLRenderTarget(this.resolution,this.resolution,c),this.adaptive&&(this.materialToneMapping.defines.ADAPTED_LUMINANCE=1,this.materialToneMapping.uniforms.luminanceMap.value=this.luminanceRT),this.quad.material=new b.MeshBasicMaterial({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLuminosity.needsUpdate=!0,this.materialToneMapping.needsUpdate=!0},q.prototype.setAdaptive=function(a){a?(this.adaptive=!0,this.materialToneMapping.defines.ADAPTED_LUMINANCE=1,this.materialToneMapping.uniforms.luminanceMap.value=this.luminanceRT):(this.adaptive=!1,
delete this.materialToneMapping.defines.ADAPTED_LUMINANCE,this.materialToneMapping.uniforms.luminanceMap.value=void 0),this.materialToneMapping.needsUpdate=!0},q.prototype.setAdaptionRate=function(a){void 0!==a&&(this.materialAdaptiveLuminosity.uniforms.tau.value=Math.abs(a))},q.prototype.setMaxLuminance=function(a){void 0!==a&&(this.materialToneMapping.uniforms.maxLuminance.value=a)},q.prototype.setAverageLuminance=function(a){void 0!==a&&(this.materialToneMapping.uniforms.averageLuminance.value=a)},q.prototype.setMiddleGrey=function(a){void 0!==a&&(this.materialToneMapping.uniforms.middleGrey.value=a)},q.prototype.dispose=function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLuminosity&&this.materialAdaptiveLuminosity.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMapping&&this.materialToneMapping.dispose()};var R=.001953125;r.prototype=Object.create(p.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"resolution",{get:function(){return this.renderTargetX.width},set:function(a){"number"==typeof a&&(0>=a&&(a=1),this.renderTargetX.setSize(a,a),this.renderTargetY.setSize(a,a))}}),r.prototype.render=function(a,b,c,d,e){e&&a.context.disable(a.context.STENCIL_TEST),this.quad.material=this.convolutionMaterial,this.convolutionMaterial.uniforms.tDiffuse.value=c,this.convolutionMaterial.uniforms.uImageIncrement.value.copy(this.blurX),a.render(this.scene,this.camera,this.renderTargetX,!0),this.convolutionMaterial.uniforms.tDiffuse.value=this.renderTargetX,this.convolutionMaterial.uniforms.uImageIncrement.value.copy(this.blurY),a.render(this.scene,this.camera,this.renderTargetY,!0),e&&a.context.enable(a.context.STENCIL_TEST),this.renderToScreen?(this.quad.material=this.combineMaterial,this.combineMaterial.uniforms.texture1.value=c,this.combineMaterial.uniforms.texture2.value=this.renderTargetY,a.render(this.scene,this.camera)):(this.quad.material=this.copyMaterial,this.copyMaterial.uniforms.tDiffuse.value=this.renderTargetY,a.render(this.scene,this.camera,c,this.clear))},r.prototype.setSize=function(a,b){0>=a&&(a=1),0>=b&&(b=1),this.blurY.set(0,a/b*R)},s.prototype=Object.create(p.prototype),s.prototype.constructor=s,s.prototype.render=function(a,b,c,d,e){this.mainScene.overrideMaterial=this.depthMaterial,a.render(this.mainScene,this.mainCamera,this.renderTargetDepth,!0),this.mainScene.overrideMaterial=null,this.bokehMaterial.uniforms.tColor.value=c,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},t.prototype=Object.create(p.prototype),t.prototype.constructor=t,t.prototype.render=function(a,b,c,d,e){a.context.disable(context.STENCIL_TEST)},u.prototype=Object.create(p.prototype),u.prototype.constructor=u,u.prototype.render=function(a,b,c,d){this.material.uniforms.tDiffuse.value=c,this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,!1)},u.prototype.setSize=function(a,b){0>=a&&(a=1),0>=b&&(b=1),this.material.uniforms.offsetRepeat.value.z=a,this.material.uniforms.offsetRepeat.value.w=b},v.prototype=Object.create(p.prototype),v.prototype.constructor=v,v.prototype.render=function(a,b,c,d){this.material.uniforms.tDiffuse.value=c,this.material.uniforms.time.value+=d,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,!1)};var S=Object.freeze({SPORADIC:0,CONSTANT_MILD:1,CONSTANT_WILD:2});w.prototype=Object.create(p.prototype),w.prototype.constructor=w,w.prototype.render=function(a,c,d){var e=this.material.uniforms;e.tDiffuse.value=d,e.seed.value=Math.random(),e.active.value=!0,this.counter%this.breakPoint===0||this.mode===S.CONSTANT_WILD?(e.amount.value=Math.random()/30,e.angle.value=b.Math.randFloat(-Math.PI,Math.PI),e.seedX.value=b.Math.randFloat(-1,1),e.seedY.value=b.Math.randFloat(-1,1),e.distortionX.value=b.Math.randFloat(0,1),e.distortionY.value=b.Math.randFloat(0,1),this.counter=0,this.generateTrigger()):this.counter%this.breakPoint<this.breakPoint/5||this.mode===S.CONSTANT_MILD?(e.amount.value=Math.random()/90,e.angle.value=b.Math.randFloat(-Math.PI,Math.PI),e.distortionX.value=b.Math.randFloat(0,1),e.distortionY.value=b.Math.randFloat(0,1),e.seedX.value=b.Math.randFloat(-.3,.3),e.seedY.value=b.Math.randFloat(-.3,.3)):this.mode===S.SPORADIC&&(e.active.value=!1),++this.counter,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,c,!1)},w.prototype.generateTrigger=function(){this.breakPoint=b.Math.randInt(120,240)},w.prototype.generatePerturbMap=function(a){var c,d,e=a*a,f=new Float32Array(3*e);for(c=0;e>c;++c)d=b.Math.randFloat(0,1),f[3*c]=d,f[3*c+1]=d,f[3*c+2]=d;null!==this.perturbMap&&this.perturbMap.dispose(),this.perturbMap=new b.DataTexture(f,a,a,b.RGBFormat,b.FloatType),this.perturbMap.needsUpdate=!0,this.material.uniforms.tPerturb.value=this.perturbMap},x.prototype=Object.create(p.prototype),x.prototype.constructor=x,Object.defineProperty(x.prototype,"intensity",{get:function(){return this.combineMaterial.uniforms.opacity2.value},set:function(a){"number"==typeof a&&(this.combineMaterial.uniforms.opacity2.value=a,this.copyMaterial.uniforms.opacity.value=a)}}),Object.defineProperty(x.prototype,"samples",{get:function(){return Number.parseInt(this.godRaysMaterial.defines.NUM_SAMPLES_INT)},set:function(a){"number"==typeof a&&a>0&&(a=Math.floor(a),this.godRaysMaterial.defines.NUM_SAMPLES_FLOAT=a.toFixed(1),this.godRaysMaterial.defines.NUM_SAMPLES_INT=a.toFixed(0),this.godRaysMaterial.needsUpdate=!0)}});var T=new b.Color;x.prototype.render=function(a,c,d){var e;this.screenPosition.copy(this.lightSource.position).project(this.mainCamera),this.screenPosition.x=b.Math.clamp(.5*(this.screenPosition.x+1),0,1),this.screenPosition.y=b.Math.clamp(.5*(this.screenPosition.y+1),0,1),this.mainScene.overrideMaterial=this.maskMaterial,T.copy(a.getClearColor()),e=a.getClearAlpha(),a.setClearColor(0,1),a.render(this.mainScene,this.mainCamera,this.renderTargetX,!0),a.setClearColor(T,e),this.mainScene.overrideMaterial=null,this.quad.material=this.godRaysMaterial,this.godRaysMaterial.uniforms.tDiffuse.value=this.renderTargetX,a.render(this.scene,this.camera,this.renderTargetY),this.renderToScreen?(this.quad.material=this.combineMaterial,this.combineMaterial.uniforms.texture1.value=d,this.combineMaterial.uniforms.texture2.value=this.renderTargetY,a.render(this.scene,this.camera)):(this.quad.material=this.copyMaterial,this.copyMaterial.uniforms.tDiffuse.value=this.renderTargetY,a.render(this.scene,this.camera,d))};var U=new b.Matrix4;x.prototype.computeScreenPosition=function(){var a,b;U.multiplyMatrices(this.mainCamera.matrixWorldInverse,this.lightSource.matrixWorld),U.multiplyMatrices(this.mainCamera.projectionMatrix,U),b=U.elements,a=b[15],this.screenPosition.set(b[12]/a,b[13]/a,b[14]/a),this.screenPosition.multiplyScalar(.5),this.screenPosition.addScalar(.5)};var V=.5*Math.PI,W=new b.Vector3(0,0,-1),X=new b.Vector3,Y=new b.Vector3;x.prototype.computeAngularScalar=function(){return Y.copy(W),X.copy(W.applyMatrix4(this.mainCamera.matrixWorld)),W.copy(Y),Y.copy(X),X.sub(this.mainCamera.position),Y.sub(this.lightSource.position),b.Math.clamp(X.angleTo(Y)-V,0,1)},x.prototype.setSize=function(a,b){this.horizontalBlurMaterial.uniforms.strength.value=this.blurriness/a,this.verticalBlurMaterial.uniforms.strength.value=this.blurriness/b,a=Math.floor(a*this.resolutionScale),b=Math.floor(b*this.resolutionScale),0>=a&&(a=1),0>=b&&(b=1),this.renderTargetX.setSize(a,b),this.renderTargetY.setSize(a,b)},y.prototype=Object.create(p.prototype),y.prototype.constructor=y,y.prototype.render=function(a,b,c,d,e){var f,g,h=a.context;h.colorMask(!1,!1,!1,!1),h.depthMask(!1),this.inverse?(f=0,g=1):(f=1,g=0),h.enable(h.STENCIL_TEST),h.stencilOp(h.REPLACE,h.REPLACE,h.REPLACE),h.stencilFunc(h.ALWAYS,f,4294967295),h.clearStencil(g),a.render(this.scene,this.camera,c,this.clear),a.render(this.scene,this.camera,b,this.clear),h.colorMask(!0,!0,!0,!0),h.depthMask(!0),h.stencilFunc(h.EQUAL,1,4294967295),h.stencilOp(h.KEEP,h.KEEP,h.KEEP)},z.prototype=Object.create(p.prototype),z.prototype.constructor=z;var Z=new b.Color;z.prototype.render=function(a,b,c,d){var e,f=void 0!==this.clearColor;this.scene.overrideMaterial=this.overrideMaterial,f&&(Z.copy(a.getClearColor()),e=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha)),this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,c,this.clear),f&&a.setClearColor(Z,e),this.scene.overrideMaterial=null},A.prototype=Object.create(p.prototype),A.prototype.constructor=A,A.prototype.render=function(a,b,c,d){this.material.uniforms.tDiffuse.value=c,a.render(this.scene,this.camera,this.renderTarget,this.clear)},A.prototype.setSize=function(a,b){0>=a&&(a=1),0>=b&&(b=1),this.renderTarget.setSize(a,b)},B.prototype=Object.create(p.prototype),B.prototype.constructor=B,B.prototype.render=function(a,b,c,d){void 0!==this.material.uniforms[this.textureID]&&(this.material.uniforms[this.textureID].value=c),this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},C.prototype=Object.create(p.prototype),C.prototype.constructor=C,C.prototype.render=function(a,b,c,d){this.renderToScreen?(this.quad.material=this.combineMaterial,this.combineMaterial.uniforms.texture1.value=c,a.render(this.scene,this.camera)):(this.quad.material=this.copyMaterial,a.render(this.scene,this.camera,c,!1))},D.prototype.addPass=function(a){a.setSize(this.renderTarget1.width,this.renderTarget1.height),this.passes.push(a)},D.prototype.insertPass=function(a,b){a.setSize(this.renderTarget1.width,this.renderTarget1.height),this.passes.splice(b,0,a)},D.prototype.swapBuffers=function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},D.prototype.render=function(a){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var b,c,d,e,f=!1;for(b=0,c=this.passes.length;c>b;++b)d=this.passes[b],d.enabled&&(d.render(this.renderer,this.writeBuffer,this.readBuffer,a,f),d.needsSwap&&(f&&(e=this.renderer.context,e.stencilFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,a),e.stencilFunc(e.EQUAL,1,4294967295)),this.swapBuffers()),d instanceof y?f=!0:d instanceof t&&(f=!1))},D.prototype.reset=function(a){var b,c,d;void 0===a?(a=this.renderTarget1.clone(),b=this.renderer.getPixelRatio(),c=Math.floor(this.renderer.context.canvas.width/b),d=Math.floor(this.renderer.context.canvas.height/b)):(c=a.width,d=a.height),this.renderTarget1.dispose(),this.renderTarget1=a,this.renderTarget2.dispose(),this.renderTarget2=a.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.setSize(c,d)},D.prototype.setSize=function(a,b){var c,d;for(this.renderTarget1.setSize(a,b),this.renderTarget2.setSize(a,b),c=0,d=this.passes.length;d>c;++c)this.passes[c].setSize(a,b)},D.prototype.dispose=function(a,b){for(this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose(),this.renderTarget1=null,this.renderTarget2=null,this.copyPass=null;this.passes.length>0;)this.passes.pop().dispose()},a.EffectComposer=D,a.AdaptiveToneMappingPass=q,a.BloomPass=r,a.BokehPass=s,a.ClearMaskPass=t,a.DotScreenPass=u,a.FilmPass=v,a.GlitchPass=w,a.GlitchMode=S,a.GodRaysPass=x,a.MaskPass=y,a.Pass=p,a.RenderPass=z,a.SavePass=A,a.ShaderPass=B,a.TexturePass=C,a.AdaptiveLuminosityMaterial=c,a.BlurMaterial=d,a.BlurDirection=G,a.BokehMaterial=e,a.CombineMaterial=f,a.ConvolutionMaterial=h,a.CopyMaterial=i,a.DotScreenMaterial=j,a.FilmMaterial=k,a.GlitchMaterial=l,a.GodRaysMaterial=m,a.LuminosityMaterial=n,a.ToneMappingMaterial=o});